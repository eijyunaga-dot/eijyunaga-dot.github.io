<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/QR_pwa_kankyou/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#e0e7ff" />
  <title>環境整備管理</title>
  <script type="module" crossorigin src="/QR_pwa_kankyou/assets/index-Dv_zfucs.js"></script>
  <link rel="stylesheet" crossorigin href="/QR_pwa_kankyou/assets/index-DAwTJFit.css">
<link rel="manifest" href="/QR_pwa_kankyou/manifest.webmanifest"><script id="vite-plugin-pwa:register-sw" src="/QR_pwa_kankyou/registerSW.js"></script></head>

<body>
  <div id="app">
    <header class="app-header">
      <h1>環境整備管理</h1>
      <div id="user-info" class="hidden">
        <span id="current-user-name"></span>
        <button id="btn-logout" class="btn-text">ログアウト</button>
      </div>
    </header>

    <main class="app-main">
      <!-- ホーム / ログイン画面 -->
      <section id="screen-login" class="screen active">
        <h2>出勤スタッフ選択</h2>
        <div class="card glass">
          <div class="form-group">
            <label for="select-dept">部署</label>
            <select id="select-dept" class="select-box">
              <option value="">読込中...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="select-staff">スタッフ名</label>
            <select id="select-staff" class="select-box" disabled>
              <option value="">部署を選択してください</option>
            </select>
          </div>
          <button id="btn-login" class="btn-primary" disabled>タスクを確認する</button>
        </div>
      </section>

      <!-- タスク一覧画面 -->
      <section id="screen-tasks" class="screen hidden">
        <div class="header-actions">
          <h2>本日のタスク</h2>
          <button id="btn-show-map" class="btn-secondary">フロアマップ表示</button>
        </div>

        <div class="progress-bar-container">
          <div class="progress-text"><span id="completed-count">0</span> / <span id="total-count">0</span> 完了</div>
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
          </div>
        </div>

        <div id="task-list" class="task-list">
          <!-- JSで動的に追加 -->
          <div class="loading-spinner">タスクを読込中...</div>
        </div>

        <button id="btn-start-scan" class="btn-fab">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path
              d="M3 7V5a2 2 0 012-2h2M17 3h2a2 2 0 012 2v2M21 17v2a2 2 0 01-2 2h-2M7 21H5a2 2 0 01-2-2v-2M9 9h6v6H9z" />
          </svg>
          QRスキャン
        </button>
      </section>

      <!-- マップ画面 -->
      <section id="screen-map" class="screen hidden">
        <div class="header-actions">
          <h2>フロアマップ</h2>
          <button id="btn-close-map" class="btn-text">閉じる</button>
        </div>
        <div class="map-container" id="map-container">
          <!-- A.pngが背景、ピンが上にオーバーレイされる -->
          <img src="/QR_pwa_kankyou/A.png" alt="フロアマップ" id="floor-map-img" class="floor-map" />
          <div id="map-pins-layer" class="map-pins"></div>
        </div>
      </section>

      <!-- QRリーダー画面 -->
      <section id="screen-scanner" class="screen hidden">
        <div class="header-actions">
          <h2>QRコード読み取り</h2>
          <button id="btn-close-scanner" class="btn-text">キャンセル</button>
        </div>
        <div class="camera-container">
          <div id="qr-reader" class="qr-reader-window"></div>
        </div>
        <div class="scanner-instruction">
          対象の清掃場所のQRコードを<br>枠内に写してください
        </div>
      </section>
    </main>

    <!-- 通知トースト -->
    <div id="toast-container" class="toast-container hidden">
      <div id="toast-message" class="toast"></div>
    </div>
  </div>

</body>

</html>